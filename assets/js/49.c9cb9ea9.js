(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{458:function(t,v,a){"use strict";a.r(v);var _=a(49),s=Object(_.a)({},(function(){var t=this,v=t.$createElement,a=t._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql架构类问题之mha架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql架构类问题之mha架构"}},[t._v("#")]),t._v(" mysql架构类问题之MHA架构")]),t._v(" "),a("h2",{attrs:{id:"mha-架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mha-架构"}},[t._v("#")]),t._v(" MHA 架构")]),t._v(" "),a("h3",{attrs:{id:"适用的主从复制架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#适用的主从复制架构"}},[t._v("#")]),t._v(" 适用的主从复制架构")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v(" 主\n/ | \\\n")])])]),a("p",[t._v("从 1 从 2 从 3")]),t._v(" "),a("h3",{attrs:{id:"故障转移步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#故障转移步骤"}},[t._v("#")]),t._v(" 故障转移步骤")]),t._v(" "),a("ul",[a("li",[t._v("选举具有最新更新的 slave")]),t._v(" "),a("li",[t._v("尝试从宕机的 master 保存二进制日志")]),t._v(" "),a("li",[t._v("应用差异的中继日志到其他 slave")]),t._v(" "),a("li",[t._v("应用从 master 保存的二进制日志")]),t._v(" "),a("li",[t._v("提升选举的 slave 为新的 master")]),t._v(" "),a("li",[t._v("配置其他 slave 向新的 mater 同步")])]),t._v(" "),a("h3",{attrs:{id:"架构需要的资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构需要的资源"}},[t._v("#")]),t._v(" 架构需要的资源")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("资源")]),t._v(" "),a("th",[t._v("数量")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("主 DB")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("用于初始主从复制模式的 master 服务器")])]),t._v(" "),a("tr",[a("td",[t._v("从 DB")]),t._v(" "),a("td",[t._v("2-N")]),t._v(" "),a("td",[t._v("可以配置 2 台或多台从服务器")])]),t._v(" "),a("tr",[a("td",[t._v("IP 地址")]),t._v(" "),a("td",[t._v("n+2")]),t._v(" "),a("td",[t._v("N 为 MySQL 服务器数量")])]),t._v(" "),a("tr",[a("td",[t._v("监控用户")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("用于监控数据库状态的 MySQL 用户（all privileges）")])]),t._v(" "),a("tr",[a("td",[t._v("复制用户")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("用于配置 MySQL 复制的 MySQL 用户（replication slave）")])])])]),t._v(" "),a("h3",{attrs:{id:"架构配置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构配置步骤"}},[t._v("#")]),t._v(" 架构配置步骤")]),t._v(" "),a("ul",[a("li",[t._v("配置一主多从复制的集群架构")]),t._v(" "),a("li",[t._v("安装 centos 的 YUM 扩展包")]),t._v(" "),a("li",[t._v("配置集群内各主机的 SSH 免认证")]),t._v(" "),a("li",[t._v("在各节点安装 mha_node")]),t._v(" "),a("li",[t._v("在管理节点安装 mha_manager")]),t._v(" "),a("li",[t._v("配置并启动 MHA 管理进程")])]),t._v(" "),a("h3",{attrs:{id:"架构优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构优点"}},[t._v("#")]),t._v(" 架构优点")]),t._v(" "),a("ul",[a("li",[t._v("支持 GTID 的复制方式和基于日志点的复制方式")]),t._v(" "),a("li",[t._v("可从多个 slave 中选举最适合的新 master")]),t._v(" "),a("li",[t._v("会尝试从旧 master 中尽可能多的保存未同步日志")])]),t._v(" "),a("h3",{attrs:{id:"架构缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构缺点"}},[t._v("#")]),t._v(" 架构缺点")]),t._v(" "),a("ul",[a("li",[t._v("未必能获取到旧 master 未同步的日志（主备使用 5.7 以后的半同步复制）")]),t._v(" "),a("li",[t._v("需要自行开发写 VIP 转移脚本")]),t._v(" "),a("li",[t._v("只监控 master 而没有对 slave 实现高可用的办法")])]),t._v(" "),a("h3",{attrs:{id:"架构适用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构适用场景"}},[t._v("#")]),t._v(" 架构适用场景")]),t._v(" "),a("ul",[a("li",[t._v("使用基于 GTID 的复制方式")]),t._v(" "),a("li",[t._v("使用一主多从的复制架构")]),t._v(" "),a("li",[t._v("希望更少数据丢失的场景")])]),t._v(" "),a("h2",{attrs:{id:"欢迎扫描下方二维码，个人博客，持续关注："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#欢迎扫描下方二维码，个人博客，持续关注："}},[t._v("#")]),t._v(" 欢迎扫描下方二维码，"),a("a",{attrs:{href:"https://www.phpst.cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("个人博客"),a("OutboundLink")],1),t._v("，持续关注：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ww1.sinaimg.cn/large/a616b9a4gy1g4xzv954a4j20760763yo.jpg",alt:""}})]),t._v(" "),a("p",[t._v("互联网工程师（id:phpstcn），我们一起学习，一起进步")])])}),[],!1,null,null,null);v.default=s.exports}}]);