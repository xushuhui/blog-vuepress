(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{395:function(a,e,s){"use strict";s.r(e);var t=s(26),r=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"node新手课（17）点赞"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node新手课（17）点赞"}},[a._v("#")]),a._v(" node新手课（17）点赞")]),a._v(" "),s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),s("p",[a._v("上节课我们讲了讲和打卡，今天我们来讲点赞。")]),a._v(" "),s("h2",{attrs:{id:"需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[a._v("#")]),a._v(" 需求")]),a._v(" "),s("p",[a._v("用户对信息列表中的信息进行点赞操作。")]),a._v(" "),s("h2",{attrs:{id:"功能流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能流程"}},[a._v("#")]),a._v(" 功能流程")]),a._v(" "),s("p",[a._v("前端传到后端信息card_id，后端根据card_id和token解析出来的user_id，查询card_praise表，如果记录存在说明已经点赞过了，返回给前端提示。否则插入card_praise，再更新card表的praise字段的值。")]),a._v(" "),s("h2",{attrs:{id:"代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[a._v("#")]),a._v(" 代码")]),a._v(" "),s("blockquote",[s("p",[a._v("routes/index.js")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("//点赞\nrouter.post('/praise', auth,async (ctx, next) => {\n  return indexApi.praise(ctx)\n})\n")])])]),s("blockquote",[s("p",[a._v("api/index.js")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('const praise = async(ctx) => {\n    const cardId = ctx.request.body.card_id\n    const userId = ctx.state.userId\n    let id =  await cardModel.getCardPraise(cardId,userId)\n    if(id > 0){\n        ctx.body = resp.fail(20001,"不要重复点赞")\n        return\n    }\n    await cardModel.createCardPraise(cardId,userId)\n    await cardModel.incrCardPraise(cardId)\n    ctx.body = resp.succeed()\n    return\n}\n')])])]),s("blockquote",[s("p",[a._v("model/cardmodel.js")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('const createCardPraise = async(cardId,userId)=>{\n    let sql = "insert into  `card_praise` (card_id,user_id)values(?,?) "\n    const insertData = await mysql.exec(sql,[cardId,userId]) \n    return insertData.insertId\n}\nconst getCardPraise = async(cardId,userId)=>{\n    let sql = "select id from `card_praise` where card_id=? and user_id=?"\n    const res = await mysql.queryOne(sql,[cardId,userId]) \n    return res.id\n}\nconst incrCardPraise = async(cardId)=>{\n    let sql = "update  `card` set praise=praise+1 where id=?"\n    const res = await mysql.exec(sql,[cardId]) \n    return res.affectedRows\n}\n')])])]),s("h2",{attrs:{id:"运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[a._v("#")]),a._v(" 运行")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('POST http://localhost:3000/praise\n\n{\n    "card_id":1\n}\n')])])]),s("p",[s("img",{attrs:{src:"https://cdn.guojiang.club/Fo6qftIGMQq8uM7ANRdWs9Kskow5",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),s("p",[a._v("点赞功能就讲完了，你掌握了吗？有问题欢迎到群里和志同道合的小伙伴一起交流。")]),a._v(" "),s("p",[a._v("下节课我们讲解查询首页列表，继续加油吧，Let's go！")])])}),[],!1,null,null,null);e.default=r.exports}}]);