(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{449:function(s,n,t){"use strict";t.r(n);var e=t(49),a=Object(e.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"node新手课（9）nodejs操作mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node新手课（9）nodejs操作mysql"}},[s._v("#")]),s._v(" node新手课（9）nodejs操作mysql")]),s._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[s._v("上节课我们讲了 koa2 的路由，今天我们来讲解 nodejs 操作 mysql")]),s._v(" "),t("h2",{attrs:{id:"导入-sql-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入-sql-文件"}},[s._v("#")]),s._v(" 导入 sql 文件")]),s._v(" "),t("p",[s._v("sql 文件地址\nhttps://github.com/guojiangclub/sir-node/blob/master/sir.sql")]),s._v(" "),t("p",[s._v("安装 navicat，打开 navicat, 选择连接-新建连接，输入本地数据库地址，用户名和密码，成功连接到数据库。\n"),t("img",{attrs:{src:"https://cdn.guojiang.club/FuQJiWpd5-q2ZVzm6hghmJzeIryt",alt:""}})]),s._v(" "),t("p",[s._v("右键点击连接，选择新建数据库 sir\n"),t("img",{attrs:{src:"https://cdn.guojiang.club/FgrETE_GzfyWtx0DiUmSRsLCYDTg",alt:""}})]),s._v(" "),t("p",[s._v("右键点击 sir 数据库，选择运行数据库，导入 sql 文件。\n"),t("img",{attrs:{src:"https://cdn.guojiang.club/FhTvIFpFIi4U2w9Wr8tRwMALGRz6",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"mysql-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-测试"}},[s._v("#")]),s._v(" mysql 测试")]),s._v(" "),t("p",[s._v("新建 mysql-test 目录，新建 index.js")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("const mysql = require('mysql')\n\n// 创建链接对象\n const con = mysql.createConnection({\n    host: 'localhost',\n    user: '数据库用户名',\n    password: '数据库密码',\n    port: '数据库端口，默认 3306',\n    database: 'sir'\n})\n\n// 开始连接\n con.connect()\n\n// 执行 sql 语句\n const sql = `insert into test (title, content, author) values (' 标题 C', ' 内容 C','zhangsan');`\ncon.query(sql, (err, result) => {\n    if (err) {\n        console.error(err)\n        return\n    }\n    console.log(result)\n})\n\n// 关闭连接\n con.end()\n")])])]),t("p",[s._v("执行如下操作")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ cd mysql-test/\n$ npm init -y\n$ npm i mysql --save\n$ node index.js\n")])])]),t("p",[s._v("打开 sir 数据库，查看 test 表，现在已经新增了一条记录。")]),s._v(" "),t("h2",{attrs:{id:"项目添加-mysql-包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目添加-mysql-包"}},[s._v("#")]),s._v(" 项目添加 mysql 包")]),s._v(" "),t("p",[s._v("在 sir-koa 目录执行")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npm i mysql --save\n")])])]),t("p",[s._v("在 sir-koa 目录下新建 config 目录，用来存放所有项目配置文件。")]),s._v(" "),t("blockquote",[t("p",[s._v("config/mysql.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("const Config = {\n    host     : 'localhost',\n    user     : '数据库用户名',\n    password : '数据库密码',\n    port:3306,\n    database : 'sir',\n   \n}\nmodule.exports= {\n    Config\n}\n")])])]),t("p",[s._v("model 目录中新建 mysql.js，用来在项目中调用 mysql")]),s._v(" "),t("blockquote",[t("p",[s._v("model/mysql.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("const mysql = require('mysql')\nconst { Config } = require('../../config/mysql')\n\n// 创建链接对象\n const con = mysql.createConnection(Config)\n\n// 开始链接\n con.connect()\n\n// 统一执行 sql 的函数\n function exec(sql,params) {\n    const promise = new Promise((resolve, reject) => {\n        con.query(sql,params, (err, result) => {\n            if (err) {\n                reject(err)\n                return\n            }\n            resolve(result)\n        })\n    })\n    return promise\n}\n\nmodule.exports = {\n    exec,\n    escape: mysql.escape\n}\n")])])]),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("nodejs 操作 mysql 就讲完了，你掌握了吗？有问题欢迎到群里和志同道合的小伙伴一起交流。")]),s._v(" "),t("p",[s._v("下节课我们讲解微信小程序注册和登录，继续加油吧，Let's go！")])])}),[],!1,null,null,null);n.default=a.exports}}]);