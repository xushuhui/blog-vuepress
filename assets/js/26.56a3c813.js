(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{435:function(t,e,s){"use strict";s.r(e);var a=s(49),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"node新手课（14）修改用户信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node新手课（14）修改用户信息"}},[t._v("#")]),t._v(" node新手课（14）修改用户信息")]),t._v(" "),s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("p",[t._v("上节课我们讲了用户信息展示，今天我们来讲修改用户信息功能。")]),t._v(" "),s("h2",{attrs:{id:"需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[t._v("#")]),t._v(" 需求")]),t._v(" "),s("p",[t._v("用户修改自己的信息，如头像，昵称，手机号等，我们以修改昵称为例。")]),t._v(" "),s("h2",{attrs:{id:"功能流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能流程"}},[t._v("#")]),t._v(" 功能流程")]),t._v(" "),s("p",[t._v("通过用户凭据 token 获取到用户 id，在数据库 user 表中找到用户记录，把前端传来的昵称更新到记录中。")]),t._v(" "),s("h2",{attrs:{id:"代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[t._v("#")]),t._v(" 代码")]),t._v(" "),s("blockquote",[s("p",[t._v("routes/user.js")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("//更新个人信息\nuserrouter.put('/info',auth, function (ctx, next) {\n  return userApi.info(ctx) \n})\n")])])]),s("blockquote",[s("p",[t._v("api/user.js")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("const info = async(ctx) => {\n    const nickname = ctx.request.body.nickname\n    await userModel.updateUserInfo(userId,nickname)\n    ctx.body = resp.succeed()\n    return\n}\n")])])]),s("blockquote",[s("p",[t._v("model/usermodel.js")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('const updateUserInfo = async(userId,nickname)=>{\n    let sql = "update  `user` set nickname=? where id=?"\n    const res = await mysql.exec(sql,[nickname,userId]) \n    return res.affectedRows\n}\n')])])]),s("h2",{attrs:{id:"运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[t._v("#")]),t._v(" 运行")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('PUT http://localhost:3000/user/info\n\n{\n    "nickname":"test"\n}\n')])])]),s("p",[s("img",{attrs:{src:"https://cdn.guojiang.club/Fo6qftIGMQq8uM7ANRdWs9Kskow5",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("修改用户信息功能就讲完了，你掌握了吗？有问题欢迎到群里和志同道合的小伙伴一起交流。")]),t._v(" "),s("p",[t._v("下节课我们讲解图片上传，继续加油吧，Let's go！")])])}),[],!1,null,null,null);e.default=r.exports}}]);