(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{455:function(t,e,a){"use strict";a.r(e);var s=a(49),_=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql基础（4）执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql基础（4）执行计划"}},[t._v("#")]),t._v(" mysql基础（4）执行计划")]),t._v(" "),a("h2",{attrs:{id:"配置慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置慢查询日志"}},[t._v("#")]),t._v(" 配置慢查询日志")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("set global slow_query_log = [ON|OFF]\nset global slow_query_log_file = /sql_log/slowlog.log\nset global long_query_time= xx.xxx 秒\nset global log_queries_not_using_indexes= [ON|OFF]\n")])])]),a("h2",{attrs:{id:"分析慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析慢查询日志"}},[t._v("#")]),t._v(" 分析慢查询日志")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mysqldumpslow [options](logs)\npt-query-digest [options](files)[dsn]\n")])])]),a("h2",{attrs:{id:"实时监控慢查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时监控慢查询"}},[t._v("#")]),t._v(" 实时监控慢查询")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select id `user` , `host` ,DB,command, `time` ,state,info from information_schema.PROCESSList where time >=60;\n")])])]),a("h2",{attrs:{id:"分析执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析执行计划"}},[t._v("#")]),t._v(" 分析执行计划")]),t._v(" "),a("p",[t._v("explain sql")]),t._v(" "),a("h3",{attrs:{id:"id-列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#id-列"}},[t._v("#")]),t._v(" id 列")]),t._v(" "),a("ul",[a("li",[t._v("id 表示查询执行顺序")]),t._v(" "),a("li",[t._v("id 相同时由上到下执行")]),t._v(" "),a("li",[t._v("id 不同时由大到小执行")])]),t._v(" "),a("h3",{attrs:{id:"select-type-列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#select-type-列"}},[t._v("#")]),t._v(" select_type 列")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("SIMPLE")]),t._v(" "),a("td",[t._v("不包含子查询或是 union 操作的查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("PRIMARY")]),t._v(" "),a("td",[t._v("查询中如果包含任何子查询，那么最外层的查询则是 PRIMARY")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("SUBQUERY")]),t._v(" "),a("td",[t._v("SELECT 列表中的子查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("DEPENDENT SUBQUERY")]),t._v(" "),a("td",[t._v("依赖外部结果的子查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("UNION")]),t._v(" "),a("td",[t._v("UNION 操作的第二个或是之后的查询的值为 union")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("DEPENDENT UNION")]),t._v(" "),a("td",[t._v("当 UNION 作为子查询的时候，第二或者第二个后的查询的 select_type 值")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("UNION RESULT")]),t._v(" "),a("td",[t._v("UNION 产生的结果集")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("DERIVED")]),t._v(" "),a("td",[t._v("出现在 from 子句中的子查询")])])])]),t._v(" "),a("h3",{attrs:{id:"table-列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#table-列"}},[t._v("#")]),t._v(" table 列")]),t._v(" "),a("ul",[a("li",[t._v("指明从哪个表获取数据")]),t._v(" "),a("li",[t._v("<union M, N>由 id 列为 M, N 查询 union 产生的结果集")]),t._v(" "),a("li",[a("derived",{attrs:{N:""}},[t._v("/"),a("subquery",{attrs:{N:""}},[t._v(" 由 id 列为 N 的查询产生的结果")])],1)],1)]),t._v(" "),a("h3",{attrs:{id:"partitions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#partitions"}},[t._v("#")]),t._v(" partitions")]),t._v(" "),a("ul",[a("li",[t._v("对于分区表，显示查询的分区 id")]),t._v(" "),a("li",[t._v("对于非分区表，显示 null")])]),t._v(" "),a("h3",{attrs:{id:"type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#type"}},[t._v("#")]),t._v(" type")]),t._v(" "),a("p",[t._v("性能由高到低")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("NULL")]),t._v(" "),a("td",[t._v("MySQL 在优化过程中分解语句，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("system")]),t._v(" "),a("td",[t._v("cost 连接类型的一个特例，当查询的表只有一行时使用")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("const")]),t._v(" "),a("td",[t._v("表中有且只有一个匹配的行时使用，如对主键或唯一索引的查询，这是效率最高的联接方式")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("eq_ref")]),t._v(" "),a("td",[t._v("唯一索引或主键查找，对于每个索引键，表中只有一条记录与之匹配")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("ref")]),t._v(" "),a("td",[t._v("非唯一索引查找，返回匹配某个单独值的所有行")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("ref_or_null")]),t._v(" "),a("td",[t._v("类似与 ref 类型查询，但是附加了对 null 值列的查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("index_merge")]),t._v(" "),a("td",[t._v("使用了索引合并优化")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("range")]),t._v(" "),a("td",[t._v("索引范围扫描，常见于 between, >, 《这样的查询条件")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("index")]),t._v(" "),a("td",[t._v("全索引扫描，遍历索引树")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("all")]),t._v(" "),a("td",[t._v("全表扫描，效率最差")])])])]),t._v(" "),a("h3",{attrs:{id:"possible-keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#possible-keys"}},[t._v("#")]),t._v(" possible_keys")]),t._v(" "),a("ul",[a("li",[t._v("查询时可能使用的索引")])]),t._v(" "),a("h3",{attrs:{id:"key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#key"}},[t._v("#")]),t._v(" key")]),t._v(" "),a("ul",[a("li",[t._v("查询时实际使用的索引")])]),t._v(" "),a("h3",{attrs:{id:"key-len"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#key-len"}},[t._v("#")]),t._v(" key_len")]),t._v(" "),a("ul",[a("li",[t._v("实际使用索引的最大长度")])]),t._v(" "),a("h3",{attrs:{id:"ref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ref"}},[t._v("#")]),t._v(" ref")]),t._v(" "),a("ul",[a("li",[t._v("哪些列或产量用于索引查找")])]),t._v(" "),a("h3",{attrs:{id:"rows"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rows"}},[t._v("#")]),t._v(" rows")]),t._v(" "),a("ul",[a("li",[t._v("根据统计信息预估扫描行数")])]),t._v(" "),a("h3",{attrs:{id:"filtered"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filtered"}},[t._v("#")]),t._v(" filtered")]),t._v(" "),a("ul",[a("li",[t._v("返回结果行数占读取行数的百分比")])]),t._v(" "),a("h3",{attrs:{id:"extra"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extra"}},[t._v("#")]),t._v(" extra")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Distinct")]),t._v(" "),a("td",[t._v("优化 distinct 操作，在找到第一匹配的元祖后即停止找同样值的动作")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Not exists")]),t._v(" "),a("td",[t._v("使用 not exist 优化查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Using filesort")]),t._v(" "),a("td",[t._v("使用文件来排序，通常会出现在 order by 或 groub by 查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Using index")]),t._v(" "),a("td",[t._v("使用覆盖索引进行查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Using temporary")]),t._v(" "),a("td",[t._v("使用临时表进行处理查询，常见于排序，子查询和分组查询")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Using where")]),t._v(" "),a("td",[t._v("使用 where 条件过滤数据")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("select tables optimized away")]),t._v(" "),a("td",[t._v("直接通过索引获取数据，不用访问表")])])])]),t._v(" "),a("h2",{attrs:{id:"欢迎扫描下方二维码，个人博客，持续关注："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#欢迎扫描下方二维码，个人博客，持续关注："}},[t._v("#")]),t._v(" 欢迎扫描下方二维码，"),a("a",{attrs:{href:"https://www.phpst.cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("个人博客"),a("OutboundLink")],1),t._v("，持续关注：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ww1.sinaimg.cn/large/a616b9a4gy1g4xzv954a4j20760763yo.jpg",alt:""}})]),t._v(" "),a("p",[t._v("互联网工程师（id:phpstcn），我们一起学习，一起进步")])])}),[],!1,null,null,null);e.default=_.exports}}]);