(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{479:function(t,a,_){"use strict";_.r(a);var s=_(49),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,_=t._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"mysql面试（8）管理及监控类问题"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mysql面试（8）管理及监控类问题"}},[t._v("#")]),t._v(" mysql面试（8）管理及监控类问题")]),t._v(" "),_("h2",{attrs:{id:"性能类指标"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#性能类指标"}},[t._v("#")]),t._v(" 性能类指标")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("名称")]),t._v(" "),_("th",[t._v("说明")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("QPS")]),t._v(" "),_("td",[t._v("数据库每秒处理的请求数量")])]),t._v(" "),_("tr",[_("td",[t._v("TPS")]),t._v(" "),_("td",[t._v("数据库每秒处理的事务数量")])]),t._v(" "),_("tr",[_("td",[t._v("并发数")]),t._v(" "),_("td",[t._v("数据库实例当前并行处理的会话数量")])]),t._v(" "),_("tr",[_("td",[t._v("连接数")]),t._v(" "),_("td",[t._v("连接到数据库会话的数量")])]),t._v(" "),_("tr",[_("td",[t._v("缓存命中率")]),t._v(" "),_("td",[t._v("Innodb 缓存命中率")])])])]),t._v(" "),_("h2",{attrs:{id:"功能类指标"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#功能类指标"}},[t._v("#")]),t._v(" 功能类指标")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("名称")]),t._v(" "),_("th",[t._v("说明")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("可用性")]),t._v(" "),_("td",[t._v("数据库是否可正常对外提供服务")])]),t._v(" "),_("tr",[_("td",[t._v("阻塞")]),t._v(" "),_("td",[t._v("当前是否有阻塞的会话")])]),t._v(" "),_("tr",[_("td",[t._v("死锁")]),t._v(" "),_("td",[t._v("当前事务是否产生了死锁")])]),t._v(" "),_("tr",[_("td",[t._v("慢查询")]),t._v(" "),_("td",[t._v("实时慢查询监控")])]),t._v(" "),_("tr",[_("td",[t._v("主从延迟")]),t._v(" "),_("td",[t._v("数据库主从延迟时间")])]),t._v(" "),_("tr",[_("td",[t._v("主从状态")]),t._v(" "),_("td",[t._v("数据库主从复制链路是否正常")])])])]),t._v(" "),_("h2",{attrs:{id:"qps"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#qps"}},[t._v("#")]),t._v(" QPS")]),t._v(" "),_("ul",[_("li",[t._v("show global status like 'Com%'")]),t._v(" "),_("li",[t._v("Sum(Com_XXX)")]),t._v(" "),_("li",[t._v("show global status like 'Queries'")]),t._v(" "),_("li",[t._v("QOS=(Queries2-Queries1)/ 时间间隔")])]),t._v(" "),_("h2",{attrs:{id:"tps"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#tps"}},[t._v("#")]),t._v(" TPS")]),t._v(" "),_("ul",[_("li",[t._v("show global status where Variable_name in ('com_insert','com_delete','com_update')")]),t._v(" "),_("li",[t._v("TC≈com_insert+com_delete+com_update")]),t._v(" "),_("li",[t._v("TPS≈(TC2-TC1)/(time2-time1)")])]),t._v(" "),_("h2",{attrs:{id:"数据库并发数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据库并发数"}},[t._v("#")]),t._v(" 数据库并发数")]),t._v(" "),_("ul",[_("li",[t._v("show global status like 'threads_running'")])]),t._v(" "),_("h2",{attrs:{id:"数据库连接数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据库连接数"}},[t._v("#")]),t._v(" 数据库连接数")]),t._v(" "),_("ul",[_("li",[t._v("show global status like 'threads_connected'")]),t._v(" "),_("li",[t._v("报警阈值 threads_connected/max_connection>0.8")])]),t._v(" "),_("h2",{attrs:{id:"innodb-缓存命中率"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#innodb-缓存命中率"}},[t._v("#")]),t._v(" Innodb 缓存命中率")]),t._v(" "),_("ul",[_("li",[t._v("(Innodb_buffer_pool_read_requests-Innodb_buffer_pool_reads)/Innodb_buffer_pool_read_requests*100%")]),t._v(" "),_("li",[t._v("Innodb_buffer_pool_read_requests: 从缓冲池读取的次数")]),t._v(" "),_("li",[t._v("Innodb_buffer_pool_reads: 从物理磁盘读取的次数")])]),t._v(" "),_("h2",{attrs:{id:"数据库可用性"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据库可用性"}},[t._v("#")]),t._v(" 数据库可用性")]),t._v(" "),_("ul",[_("li",[t._v("周期性连接数据库服务器并执行 select @@version;")]),t._v(" "),_("li",[t._v("Nysqladmin -uxxx -pxxx -hxxx ping")])]),t._v(" "),_("h2",{attrs:{id:"阻塞"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#阻塞"}},[t._v("#")]),t._v(" 阻塞")]),t._v(" "),_("h3",{attrs:{id:"mysql5-7"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mysql5-7"}},[t._v("#")]),t._v(" < MySQL5.7")]),t._v(" "),_("div",{staticClass:"language-mysql extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("SELECT b.trx_mysql_thread_id AS '被阻塞线程',b.trx_query AS '被阻塞 SQL',c.trx_mysql_thread_id AS '阻塞线程',c.trx_query AS '阻塞 SQL',(UNIX_TIMESTAMP()-UNIX_TIMESTAMP(c.trx_started)) AS '阻塞时间' FROM information_schema.innodb_lock_waits a JOIN information_schema.innodb_trx b ON a.requesting_trx_id=b.trx_id JOIN information_schema.innodb_trx c ON a.blocking_trx_id=c.trx_id WHERE (UNIX_TIMESTAMP()-UNIX_TIMESTAMP(c.trx_started))>30\n")])])]),_("h3",{attrs:{id:"mysql5-7-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mysql5-7-2"}},[t._v("#")]),t._v(" > = MySQL5.7")]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("SELECT waiting_pid AS '被阻塞线程',waiting_query AS '被阻塞 SQL',blocking_pid AS '阻塞线程',blocking_query AS '阻塞 SQL',wait_age AS '阻塞时间',sql_kill_blocking_query AS '建议操作' FROM sys.innodb_lock_waits WHERE (UNIX_TIMESTAMP()-UNIX_TIMESTAMP(wait_started))>30\n")])])]),_("h2",{attrs:{id:"死锁"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#死锁"}},[t._v("#")]),t._v(" 死锁")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("show engine innodb status")])]),t._v(" "),_("li",[_("p",[t._v("pt-deadlock-logger u=xx,p=xxxx,h=127.0.0.1 --create-dest-table --dest u=xx,p=xxx,h=127.0.0.1,D=crn,t=deadlock")])]),t._v(" "),_("li",[_("p",[t._v("set global innodb_print_all_deadlocks=on")])])]),t._v(" "),_("h2",{attrs:{id:"监控慢查询"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#监控慢查询"}},[t._v("#")]),t._v(" 监控慢查询")]),t._v(" "),_("ul",[_("li",[t._v("通过慢查询日志监控")]),t._v(" "),_("li",[t._v("通过 information_schema."),_("code",[t._v("PROCESSLIST")]),t._v("表实时监控")])]),t._v(" "),_("h2",{attrs:{id:"监控主从延时"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#监控主从延时"}},[t._v("#")]),t._v(" 监控主从延时")]),t._v(" "),_("ul",[_("li",[t._v("show slave status (Seconds_Behind_Master)")]),t._v(" "),_("li",[t._v("pt-heartbeat --user=xx --password=xxx -h master --create-table --database xxx --update --daemonize --interval=1")]),t._v(" "),_("li",[t._v("pt-heartbeat --user=xx --password=xxx -h slave --create-table --database crn --monitor --daemonize --log /tmp/slave_lag.log")])]),t._v(" "),_("h2",{attrs:{id:"监控主从状态"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#监控主从状态"}},[t._v("#")]),t._v(" 监控主从状态")]),t._v(" "),_("ul",[_("li",[t._v("show slave status (Slave_IO_Running,Slave_SQL_Running,Last_Errno,Last_Error)")])]),t._v(" "),_("h2",{attrs:{id:"欢迎扫描下方二维码，个人博客，持续关注："}},[_("a",{staticClass:"header-anchor",attrs:{href:"#欢迎扫描下方二维码，个人博客，持续关注："}},[t._v("#")]),t._v(" 欢迎扫描下方二维码，"),_("a",{attrs:{href:"https://www.phpst.cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("个人博客"),_("OutboundLink")],1),t._v("，持续关注：")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://ww1.sinaimg.cn/large/a616b9a4gy1g4xzv954a4j20760763yo.jpg",alt:""}})]),t._v(" "),_("p",[t._v("互联网工程师（id:phpstcn），我们一起学习，一起进步")])])}),[],!1,null,null,null);a.default=e.exports}}]);